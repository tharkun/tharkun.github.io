<!doctype html>
<html lang="en">

    <head>
        <meta charset="utf-8">

        <title>reveal.js - The HTML Presentation Framework</title>

        <meta name="description" content="A framework for easily creating beautiful presentations using HTML">
        <meta name="author" content="Hakim El Hattab">

        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

        <link rel="stylesheet" href="css/reveal.min.css">
        <link rel="stylesheet" href="css/theme/default.css" id="theme">
        <link rel="stylesheet" href="css/more.css">
        <!-- TODO : trouver un thème -->

        <!-- For syntax highlighting -->
        <link rel="stylesheet" href="lib/css/zenburn.css">

        <!-- If the query includes 'print-pdf', include the PDF print sheet -->
        <script>
            if( window.location.search.match( /print-pdf/gi ) ) {
                var link = document.createElement( 'link' );
                link.rel = 'stylesheet';
                link.type = 'text/css';
                link.href = 'css/print/pdf.css';
                document.getElementsByTagName( 'head' )[0].appendChild( link );
            }
        </script>

        <!--[if lt IE 9]>
        <script src="lib/js/html5shiv.js"></script>
        <![endif]-->
    </head>

    <body>

        <div class="reveal">

            <!-- Any section element inside of this container is displayed as a slide -->
            <div class="slides">
                <section>
                    <h1>Atoum</h1>
                    <img src="images/atoum.png" />
                    <p>
                        <small><a href="https://github.com/tharkun">Jérémy Poulain</a></small>
                    </p>
                </section>

                <!--<section>



                    <aside class="notes">
                        Oh hey, these are some notes. They'll be hidden in your presentation, but you can see them if you open the speaker notes window (hit 's' on your keyboard).
                    </aside>
                </section>-->

                <section>
                    <h2>Pourquoi Atoum ?</h2>
                    <p class="fragment">Et pourquoi pas...</p>
                    <p class="fragment">Alternative à PhpUnit & SimpleTest</p>
                    <p class="fragment">
                        <br />
                        <a href="http://florianlb.fr/talks/tests-pourquoi-comment-avec-quoi">Tests pourquoi, comment et avec quoi</a>
                        par <a href="https://twitter.com/LBFlorian">@LBFlorian</a>
                    </p>
                </section>

                <section>
                    <h2>Déroulé</h2>
                    <ul style="list-style-type: none;">
                        <li><span class="test-block chapter1"></span> Qu'est-ce ?</li>
                        <li><span class="test-block chapter2"></span> Premiers pas</li>
                        <li><span class="test-block chapter3"></span> Ecrire ses tests</li>
                        <li><span class="test-block chapter4"></span> Lancer ses tests</li>
                        <li><span class="test-block chapter5"></span> Use cases</li>
                    </ul>
                </section>

                <section data-state="chapter1">
                    <section>
                        <p>
                            Framework de tests unitaires moderne, solide et intuitif.
                        </p>
                    </section>
                    <section>
                        <img src="images/mageekguy.png" />
                        <p>
                            Créé par <a href="http://blog.mageekbox.net/">Frédéric Hardy</a> / <a href="https://twitter.com/mageekguy">@mageekguy</a>
                        </p>
                        <p>Début du projet en 2005</p>
                        <p>Naissance en mai 2010</p>
                    </section>
                    <section>
                        <h2>Quelques contributeurs</h2>
                        <ul>
                            <li>Julien Bianchi</li>
                            <li>Ludovic Fleury</li>
                            <li>Gérald Croes</li>
                            <li>François Dussert</li>
                        </ul>
                        <p>&nbsp;</p>
                        <p><a href="https://github.com/atoum/atoum/blob/master/CREDITS.md">Voir la liste</a></p>
                    </section>
                    <section>
                        <h2>Principes fondateurs</h2>
                        <ul>
                            <li>Modernité</li>
                            <li>Rapidité</li>
                            <li>Simplicité</li>
                            <li>Fiabilité</li>
                        </ul>
                    </section>
                    <section>
                        <h2>Modernité ?</h2>
                        <ul>
                            <li>Incompatible PHP 5.2</li>
                            <li>Phar</li>
                            <li>Fonctions anonymes</li>
                            <li>Fluent interface</li>
                            <li>Code coverage avec XDebug</li>
                        </ul>
                    </section>
                    <section>
                        <h2>Rapidité ?</h2>
                        <ul>
                            <li>Installation éclaire</li>
                            <li>Archive Phar unique</li>
                            <li>Gain de temps</li>
                        </ul>
                    </section>
                    <section>
                        <h2>Simplicité ?</h2>
                        <ul>
                            <li>Language naturel</li>
                            <li>Intuitif</li>
                            <li>Evolutif</li>
                            <li>Bouchonnage facile</li>
                            <li>Possibilité de choisir les tests à exécuter</li>
                        </ul>
                    </section>
                    <section>
                        <h2>Fiabilité ?</h2>
                        <p class="current-fragment">Isolation des tests</p>
                        <ul class="fragment">
                            <li>Sous processus</li>
                            <li>Pas d'interaction entre les tests</li>
                            <li>Une erreur arrête LE test et non pas les tests</li>
                        </ul>
                    </section>
                    <section>
                        <h2>Fiabilité ?</h2>
                        <p class="current-fragment">Traçage des erreurs & exceptions</p>
                        <pre class="fragment"><code data-trim class="sh">
php vendor/mageekguy.atoum.phar -f src/Vendor/Project/tests/units/foo.php
...
> Vendor\Project\tests\units\foo...
[E___________________________________________________________][0/1]
=> Test duration : 0.02 second.
=> Memory usage : 0.00 Mb.
...
Failure (1 test, 1 method, 0 assertions, 1 error, 0 exception) !
> There is 1 error:
=> Vendor\Project\tests\units\foo::bar():
==> Error 255 in /path/to/file/foo.php on line 12:
Fatal error: Call to undefined function bar()
                        </code></pre>
                    </section>
                    <section>
                        <h2>Fiabilité</h2>
                        <p class="current-fragment">Se teste lui-même (+ 23000 assertions)</p>
                        <pre class="fragment"><code data-trim class="sh">
php vendor/mageekguy.atoum.phar --test-it
> Total tests duration: 42.03 seconds.
> Total tests memory usage: 604.25 Mb.
> Running duration: 55.58 seconds.
Success (201 tests, 1634/1634 methods, 0 void method, 0 skipped method, 23830 assertions)
                        </code></pre>
                    </section>
                </section>

                <section data-state="chapter2">
                    <section>
                        <h2>Premier pas avec Atoum</h2>
                        <ul>
                            <li>Installation</li>
                            <li>Atoum & les IDEs</li>
                            <li>Première classe de test</li>
                        </ul>
                        <p><br /><img src="images/foot-print.gif" /></p>
                    </section>
                    <section>
                        <h2>Comment commencer ?</h2>
                        <ul>
                            <li>Télécharger l'archive <a href="http://downloads.atoum.org/nightly/mageekguy.atoum.phar" target="_blank">Phar</a></li>
                            <li><a href="https://packagist.org/packages/atoum/atoum" target="_blank">Composer</a></li>
                            <li>Dépôt <a href="https://github.com/atoum/atoum" target="_blank">Github</a></li>
                            <li>Bundle <a href="https://github.com/atoum/AtoumBundle" target="_blank">Symfony 2</a></li>
                            <li>Classe de test <a href="https://github.com/atoum/atoum/wiki/Utiliser-atoum-avec-eZ-publish" target="_blank">eZ Publish Legacy</a></li>
                            <li>Composant <a href="https://github.com/blanchonvincent/zend-framework-test-atoum" target="_blank">Zend Framework 2</a></li>
                        </ul>
                    </section>
                    <section>
                        <h2>Atoum & IDEs</h2>
                        <p class="current-fragment">Intégration parfaite avec vim</p>
                        <div class="fragment">
                            <p>Ouvrir PhpStorm en cas d'échec à un test</p>
                            <pre><code data-trim class="php">
use
    mageekguy\atoum,
    mageekguy\atoum\report\fields\runner\failures\execute\unix
;

$stdOutWriter = new atoum\writers\std\out();
$cliReport = new atoum\reports\realtime\cli();
$cliReport->addWriter($stdOutWriter);

$cliReport
    ->addField(
        new unix\phpstorm('/chemin/vers/PhpStorm/bin/phpstorm.sh')
    )
;

$runner->addReport($cliReport);
                            </code></pre>
                        </div>
                        <p class="fragment"><a href="http://youtrack.jetbrains.com/issue/WI-11602">Votez pour l'intégration d'Atoum dans PhpStorm</a></p>
                    </section>
                    <section>
                        <h2>Premier test</h2>
                        <p><strong>Classe</strong> à tester</p>
                        <pre><code data-trim class="php">
namespace Vendor\Project;

class Maxime
{
    public function queSuisJe()
    {
        return 'Un stagiaire';
    }
}
                        </code></pre>
                    </section>
                    <section>
                        <h2>Premier test</h2>
                        <p>Classe de test</p>
                        <pre><code data-trim class="php">
namespace Vendor\Project\tests\units;

class Maxime extends \atoum\test
{
    public function testQueSuisJe()
    {
        $this
            ->if( $maxime = new \Vendor\Project\Maxime() )
            ->then
                ->string($maxime->queSuisJe())
                    ->isEqualTo('Un stagiaire')
        ;
    }
}
                        </code></pre>
                    </section>
                    <section>
                        <h2>Premier test</h2>
                        <p>Sortie console</p>
                        <pre><code data-trim class="sh">
php vendor/mageekguy.atoum.phar -f src/Vendor/Project/tests/units/Maxime.php
> PHP path: /usr/bin/php
> PHP version:
=> PHP 5.4.7 (cli) (built : Sep 13 2012 04:24:47)
=> Copyright (c) 1997-2012 The PHP Group
=> Zend Engine v2.4.0, Copyright (c) 1998-2012 Zend Technologies
=>     with Xdebug v2.2.1, Copyright (c) 2002-2012, by Derick Rethans
> Vendor\Project\tests\units\Maxime...
[S___________________________________________________________][1/1]
=> Test duration : 0.02 second.
=> Memory usage : 0.00 Mb.
> Total test duration: 0.02 second.
> Total test memory usage: 0.00 Mb.
> Code coverage value: 100.00%
> Running duration: 0.34 second.
Success (1 test, 1/1 method, 2 assertions, 0 error, 0 exception) !
                        </code></pre>
                    </section>
                </section>

                <section data-state="chapter3">
                    <section>
                        <h2>Ecrire ses tests</h2>
                        <ul>
                            <li>Axiomes</li>
                            <li>Assertions</li>
                            <li>Ecriture naturelle</li>
                            <li>Mode loop / debug</li>
                            <li>Méthodes d'initisalisation</li>
                            <li>Data provider</li>
                            <li>Les bouchons (mock)</li>
                        </ul>
                    </section>
                    <section>
                        <h2>Axiomes - Théorie</h2>
                        <p class="fragment">Un test => une classe</p>
                        <ul>
                            <li class="fragment">Une classe de test requiert une classe dans le projet</li>
                            <li class="fragment">On ne peut tester que ce qui est <strong>public</strong></li>
                        </ul>
                    </section>
                    <section>
                        <h2>Axiomes - Implémentation</h2>
                        <ul>
                            <li class="fragment">
                                Classe de test = Classe testée + '\tests\units'
                                <pre><code data-trim class="php">
\Ns\My\Class => \tests\units\Ns\My\Class # OK
\Ns\My\Class => \Ns\My\tests\units\Class # OK
\Ns\My\Class => \Ns\tests\units\My\Class # OK
                                </code></pre>
                                <p class="fragment"><span class="green">Bonne pratique :</span> choisir une convention</p>
                            </li>
                            <li class="fragment">
                                La classe de test
                                <ul>
                                    <li>non abstraite</li>
                                    <li>hérite de atoum\test</li>
                                </ul>
                            </li>
                            <li class="fragment">
                                Les méthodes de test
                                <ul>
                                    <li>publiques</li>
                                    <li>non statiques</li>
                                    <li>commencent par test</li>
                                </ul>
                            </li>
                        </ul>
                    </section>
                    <section>
                        <h2>Axiomes - Exemple</h2>
                        <p>Structure d'une classe de test</p>
                        <pre><code data-trim class="php">
namespace Vendor\tests\units;

class MyClass extends \atoum\test
{
    public function testClass() { ... } # Méthode exécutée
    public function test__construct() { ... } # Méthode exécutée
    public function test__get() { ... } # Méthode exécutée
    public function testInstance() { ... } # Méthode exécutée
    public function method1() { ... } # Méthode non exécutée
    protected function method2() { ... } # Méthode non exécutée
}
                        </code></pre>
                    </section>
                    <section>
                        <h2>Assertions</h2>
                        <p>"Expression qui doit être évaluée à vrai"</p>
                        <br />
                        <pre class="fragment"><code data-trim class="php">
$foo = 'bar';

$foo === 'bar'; # Assertion vraie
$foo === false; # Assertion fausse
                        </code></pre>
                    </section>
                    <section>
                        <h2>Assertions</h2>
                        <p class="current-fragment">Que tester via les "asserters" ?</p>
                        <ul>
                            <li class="fragment">Eléments basiques : boolean, integer, string, array, float...</li>
                            <li class="fragment">Eléments évolués : class, object, mock, stream...</li>
                            <li class="fragment">Exceptions</li>
                            <li class="fragment">Créer vos asserters <span class="green">(=> Evolutif)</span></li>
                        </ul>
                        <p class="fragment"><br /><a href="http://docs.atoum.org/fr/chapitre2.html#Assertions" target="_blank">Liste des asserters fournis</a></p>
                    </section>
                    <section>
                        <h2>Language naturel</h2>
                        <p class="green">Fluent interface</p>
                        <pre><code data-trim class="php">
$this
    ->if( $a = rand(1, PHP_INT_MAX) )
    ->and( $b = $a - 1 )
    ->then
        ->integer( $a )
            ->isGreaterThan( 0 )
        ->integer( $b )
            ->isLowerThan( $a )
;
                        </code></pre>
                        <div class="fragment">
                            <p>Si $a et $b, alors</p>
                            <p>$a est un entier supérieur à 0</p>
                            <p>$b est un entier inférieur à $a</p>
                            <p><span class="green">=> Intuitif</span></p>
                        </div>
                    </section>
                    <section>
                        <h2>Mode "Loop"</h2>
                        <p>Utilisé avec l'argument --loop</p>
                        <pre><code data-trim class="sh">
...
> Vendor\MyClass...
[F___________________________________________________________][1/1]
...
Failure (1 test, 0 method, 1 failure, 0 error, 0 exception) !
> There is 1 failure:
=> Vendor\MyClass::testMethod():
In file test_file.php on line 17, asserters\string::isEqualTo()
                            failed: strings are not equals
-Reference
+Data
@@ -1 +1 @@
-string(13) "4ea0354cd717c"
+string(32) "19798c230d5462b3bdae194f364feffa"
Press &lt;Enter> to reexecute, press any other key to stop...
                        </code></pre>
                        <p><span class="green">=> Gain de temps</span></p>
                    </section>
                    <section>
                        <h2>Mode "Debug"</h2>
                        <p>Utilisé avec l'argument --debug</p>
                        <pre><code data-trim class="php">
$this
    ->if($foo = new foo())
    ->then
        ->dump($foo->getBar(), $bar) // retourne le dump
;
$this
    ->if($foo = new foo())
    ->then
        ->stop() // le test s'arrêtera ici si --debug est utilisé
;
$this
    ->if($foo = array())
    ->executeOnFailure( function() use ($foo) { var_dump($foo); } )
    ->then
        ->object($foo) // Failure -> lance la fonction anonyme
;
                        </code></pre>
                    </section>
                    <section>
                        <h2>Méthodes d'initialisation</h2>
                        <p>2 * 2 méthodes &OpenCurlyDoubleQuote;before&CloseCurlyDoubleQuote; / &OpenCurlyDoubleQuote;after&CloseCurlyDoubleQuote;</p>
                    </section>
                    <section>
                        <h2>Méthodes d'initialisation</h2>
                        <p>Global à toutes les méthodes d'une classe</p>
                        <pre><code data-trim class="php">
namespace Vendor\tests\units;

class MyClass extends atoum\test
{
    public function setUp()
    {
        // Exécutée avant l'ensemble des méthodes de test.
    }

    public function tearDown()
    {
        // Exécutée après l'ensemble des méthodes de test.
    }
}
                        </code></pre>
                    </section>
                    <section>
                        <h2>Méthodes d'initialisation</h2>
                        <p>Local à sous processus</p>
                        <pre><code data-trim class="php">
namespace Vendor\tests\units;

class MyClass extends atoum\test
{
    public function beforeTestMethod($method)
    {
        // Exécutée avant chaque méthode de test.
        switch ($method) {}
    }

    public function testMethode() {}

    public function afterTestMethod($method)
    {
        // Exécutée après chaque méthode de test.
        switch ($method) {}
    }
}
                        </code></pre>
                    </section>
                    <section>
                        <h2>Data provider</h2>
                        <p>Envoi de données à une méthode de test</p>
                        <pre class="stretch"><code data-trim class="php">
class MyClass extends atoum\test
{
    /**
     * @dataProvider methodDataProvider
     */
    public function testSum($a, $b)
    {
        // Test
    }

    /**
     * @return array|Iterator
     */
    public function methodDataProvider()
    {
        return array(
            array(0, 1),
            array(1, 0),
        );
    }
}
                        </code></pre>
                    </section>
                    <section>
                        <h2>Les bouchons</h2>
                        <img src="images/bouchon.jpg" />
                    </section>
                    <section>
                        <h2>Les bouchons (mock)</h2>
                        <br />
                        <blockquote>"not real but appearing or pretending to be exactly like something"</blockquote>
                        <br />
                        <p>Simuler le comportement d'un objet</p>
                    </section>
                    <section>
                        <h2>Déclarer un mock</h2>
                        <p>Préfixer la classe par \mock</p>
                        <pre><code data-trim class="php">
// création d'un bouchon de l'interface \Countable
$countableMock = new \mock\Countable;

// création d'un bouchon de la classe abstraite
// \Vendor\Project\AbstractClass
$vendorAppMock = new \mock\Vendor\Project\AbstractClass;

// création d'un bouchon de la classe \StdClass
$stdObject     = new \mock\StdClass;

// création d'un bouchon à partir d'une classe inexistante
$anonymousMock = new \mock\My\Unknown\Class;
                        </code></pre>
                        <p><span class="green">=> Simplicité</span></p>
                    </section>
                    <section>
                        <h2>Mock = ?</h2>
                        <pre><code data-trim class="php">
$myClass = new \mock\MyNamespace\MyClass;
                        </code></pre>
                        <p>génère automatiquement</p>
                        <pre class="fragment"><code data-trim class="php">
namespace \mock\MyNamespace;

use \MyNamespace\MyClass as mockedClass;

class MyClass extends mockedClass
{
}
                        </code></pre>
                        <p class="fragment"><strong>Mock = Héritage</strong></p>
                    </section>
                    <section>
                        <h2>Mock = Héritage ++</h2>
                        <pre class="fragment"><code data-trim class="php">
namespace \mock\MyNamespace;

use \MyNamespace\MyClass as mockedClass;

class MyClass extends mockedClass
{
    public function method1()
    {
        return parent::method1();
    }

    public function method2(array $array, $limit = 0)
    {
        return parent::method2($array, $limit);
    }
}
                        </code></pre>
                    </section>
                    <section>
                        <h2>Mock + Shunt</h2>
                        <img src="images/shunt.jpg" />
                    </section>
                    <section>
                        <h2>Shunter les appels aux méthodes parentes</h2>
                        <pre><code data-trim class="php">
$this->mockGenerator->shuntParentClassCalls();
$mock = new \mock\MyNamespace\MyClass;
$this->mockGenerator->unshuntParentClassCalls();
                        </code></pre>
                        <pre class="fragment"><code data-trim class="php">
namespace \mock\MyNamespace;

use \MyNamespace\MyClass as mockedClass;

class MyClass extends mockedClass
{
    public function method1() {}

    public function method2(array $array, $limit = 0) {}
}
                        </code></pre>
                    </section>
                    <section>
                        <h2>Shunter un appel à une méthode</h2>
                        <p>Cas : Suppression d'un appel réseau dans une méthode</p>
                        <pre><code data-trim class="php">
$this->mockGenerator->shunt('method2');
$mock = new \mock\MyNamespace\MyClass;
                        </code></pre>
                        <pre><code data-trim class="php">
namespace \mock\MyNamespace;

use \MyNamespace\MyClass as mockedClass;

class MyClass extends mockedClass
{
    public function method1()
    {
        return parent::method1();
    }

    public function method2(array $array, $limit = 0) {}
}
                        </code></pre>
                    </section>
                    <section>
                        <p><img src="images/so-cool.jpg" /></p>
                        <br />
                        <p>Mais peut mieux faire...</p>
                    </section>
                    <section>
                        <h2>Mock + méthode orpheline</h2>
                        <ul>
                            <li>Implémentation vide (= shunt)</li>
                            <li>Signature vide</li>
                        </ul>
                        <div class="fragment">
                            <p>Cas : Suppression de dépendance</p>
                            <pre><code data-trim class="php">
class FirstClass {
    public function __construct(SecondClass $dep) {
        $this->dep = $dep;
    }
}
class SecondClass {
    public function __construct(ThirdClass $dep) {
        $this->dep = $dep;
    }
}

$this->mockGenerator->orphanize('__construct');
$this->mockGenerator->shuntParentClassCalls();

$mock = new \mock\SecondClass();
$object = new FirstClass($mock);
                            </code></pre>
                        </div>
                    </section>
                    <section>
                        <p><img src="images/so-cool2.gif" /></p>
                        <br />
                        <p>Mais peut encore mieux faire...</p>
                    </section>
                    <section>
                        <h2>Redéfinir une méthode</h2>
                        <pre><code data-trim class="php">
namespace \Database;

class Client
{
    ...
    public function connect()
    {
        $this->res = mysql_connect(...);
    }
    ...
}
                        </code></pre>
                        <pre class="fragment"><code data-trim class="php">
$databaseClient = new \mock\Database\Client();

$this->calling($databaseClient)->connect = true;
$this->calling($databaseClient)->connect[1] = function()
{
    throw new \Exception("Can't connect twice");
};
                        </code></pre>
                    </section>
                    <section>
                        <p><img src="images/so-cool3.gif" /></p>
                        <br />
                        <p>On peut encore aller plus loin...</p>
                        <p>Mais on va s'arrêter là</p>
                    </section>
                </section>

                <section data-state="chapter4">
                    <section>
                        <h2>Lancer ses tests</h2>
                        <ul>
                            <li>Via l'archive phar / script</li>
                            <li>Quels tests exécuter ?</li>
                            <li>Filtrer</li>
                            <li>Configurer</li>
                            <li>Bootstraper</li>
                        </ul>
                    </section>
                    <section>
                        <h2>Lancer ses tests</h2>
                        <div class="current-fragment">
                            <p>Via l'archive</p>
                            <pre><code data-trim class="sh">
php mageekguy.atoum.phar --test-it
                            </code></pre>
                        </div>
                        <div class="fragment">
                            <p>Via le script</p>
                            <pre><code data-trim class="sh">
php script/runner.php --test-it
                            </code></pre>
                        </div>
                    </section>
                    <section>
                        <h2>Exécuter ses tests</h2>
                        <div class="current-fragment">
                            <p>Dans un fichier</p>
                            <pre><code data-trim class="sh">
php mageekguy.atoum.phar -f path_to_test_file.php
                            </code></pre>
                        </div>
                        <div class="fragment">
                            <p>Dans un répertoire</p>
                            <pre><code data-trim class="sh">
php mageekguy.atoum.phar -d path_to_directory
                            </code></pre>
                        </div>
                    </section>
                    <section>
                        <h2>Filtrer ses tests</h2>
                        <div class="current-fragment">
                            <p>Par namespace</p>
                            <pre><code data-trim class="sh">
php mageekguy.atoum.phar -d path_to_directory -ns namespace1
                            </code></pre>
                        </div>
                        <div class="fragment">
                            <p>Par classe / méthode</p>
                            <pre><code data-trim class="sh">
php mageekguy.atoum.phar -d path_to_directory -m nomDeClasse::*
php mageekguy.atoum.phar -d path_to_directory -m *::testMethode
                            </code></pre>
                        </div>
                        <div class="fragment">
                            <p>Par tags</p>
                            <pre><code data-trim class="sh">
php mageekguy.atoum.phar -d path_to_directory -t nom_de_tag1 nom_det_tag2
                            </code></pre>
                        </div>
                    </section>
                    <section>
                        <h2>Fichier de configuration</h2>
                        <p>Paramétrage global d'atoum</p>
                        <ul class="fragment">
                            <li>Couverture de code au format HTML</li>
                            <li>Notifications lors du lancement des tests</li>
                            <li>Ce que vous voulez...</li>
                        </ul>
                        <pre class="fragment"><code data-trim class="sh">
php mageekguy.atoum.phar -c path_to_file.php -d path_to_directory
                        </code></pre>
                        <p class="fragment"><strong class="red">Attention : </strong>Fichier inconnu par le sous processus</p>
                    </section>
                    <section>
                        <h2>Fichier de bootstrap</h2>
                        <p>Paramétrage de chaque test</p>
                        <ul class="fragment">
                            <li>Initialisation de l'environnement des tests</li>
                            <li>Autoload de classes testées</li>
                            <li>Ce que vous voulez...</li>
                        </ul>
                        <pre class="fragment"><code data-trim class="sh">
php mageekguy.atoum.phar -bf path_to_file.php -d path_to_directory
                        </code></pre>
                        <p class="fragment"><strong class="red">Attention : </strong>Fichier inconnu par le processus parent</p>
                    </section>
                </section>

                <section data-state="chapter5">
                    <section>
                        <h2>Use cases</h2>
                        <ul>
                            <li>Entier</li>
                            <li>Structure d'une classe</li>
                            <li>Singleton</li>
                            <li>Setter / Getter</li>
                            <li>Classe "Metadata"</li>
                            <li>Classe "Document"</li>
                            <li>Mock</li>
                        </ul>
                    </section>
                    <section>
                        <h2>Entier</h2>
                        <pre class="fragment"><code data-trim class="php">
$i = '1';
$this
    ->integer( $i ) # Faux
        ->isEqualTo( 1 ) # Faux (typage fort) mais ne sera pas testé
;
                        </code></pre>
                        <pre class="fragment"><code data-trim class="php">
$i = 1;
$this
    ->integer( $i ) # Vrai
        ->isEqualTo( 1 ) # Vrai
        ->isNotEqualTo( 2 ) # Vrai
        ->isGreaterThan( 0 ) # Vrai
;
                        </code></pre>
                    </section>
                    <section>
                        <h2>Classe</h2>
                        <pre><code data-trim class="php">
$this
    ->testedClass
        ->hasNoParent()
        ->isAbstract()
        ->hasMethod( '__get' )
;
                        </code></pre>
                    </section>
                    <section>
                        <h2>Singleton</h2>
                        <pre><code data-trim class="php">
$this
    ->if( $object = \Singleton::instance() )
    ->then
        ->object( $object )
            ->isInstanceOf( 'Singleton' )
            ->isEqualTo( \Singleton::instance() )
;
                        </code></pre>
                    </section>
                    <section>
                        <h2>Setter / Getter</h2>
                        <pre><code data-trim class="php">
$this
    ->if( $object = new \MyClass() )
    ->and( $value = uniquid() )
    ->then
        ->object( $object->setValue( $value ) )->isEqualTo( $object )
        ->string( $object->getValue() )->isEqualTo( $value )
;
                        </code></pre>
                    </section>
                    <section>
                        <h2>Exception</h2>
                        <pre><code data-trim class="php">
$this
    ->if( $object = new \MyClass() )
    ->then
        ->exception(function() use ($object) {
            $object->doSomethingThatThrowException();
        })
            ->isInstanceOf('Exception')
            ->hasMessage( '...' )
;
                        </code></pre>
                    </section>
                    <section>
                        <h2 class="no-uppercase">Metadata : Classe</h2>
                        <pre><code data-trim class="php">
class Metadata
{
    public $name;
    public $value;

    public function __construct( $name, $value )
    {
        $this->name  = $name;
        $this->value = $value;
    }
}
                        </code></pre>
                    </section>
                    <section>
                        <h2 class="no-uppercase">Metadata : Test</h2>
                        <pre><code data-trim class="php">
namespace tests\units;

class Metadata extends atoum\test
{
    public function testClass()
    {
        $this->testedClass->hasNoParent();
    }

    public function testHasMethod()
    {
        $this->testedClass->hasMethod( '__construct' );
    }
}
                        </code></pre>
                    </section>
                    <section>
                        <h2 class="no-uppercase">Metadata : Test</h2>
                        <pre><code data-trim class="php">
namespace tests\units;

class Metadata extends atoum\test
{
    public function test__construct()
    {
        $this
            ->if( $name = uniqid() )
            ->and( $value = uniqid() )
            ->and( $object = new \Metadata($name, $value) )
            ->then
                ->string($object->name)->isEqualTo($name)
                ->string($object->value)->isEqualTo($value)
        ;
    }
}
                        </code></pre>
                        <p class="fragment">Couverture de code : 100%</p>
                    </section>
                    <section>
                        <h2 class="no-uppercase">Document : Classe</h2>
                        <pre class="stretch"><code data-trim class="php">
class Document
{
    public function __construct() {}

    public function __get($sName)
    {
        foreach ($this->metadatas as $key => $meta)
        {
            if ($meta->name == $sName)
            {
                return $meta->value;
            }
        }
        throw new \Exception("Unable to __get $sName properties.");
    }

    public function addMeta( $metaName, $metaValue )
    {
        $metas = $this->metadatas;
        foreach ($metas as $key => $meta)
        {
            if ($meta->name == $metaName)
            {
                unset($this->metadatas[$key]);
            }
        }
        $this->metadatas[] = new \Metadata( $metaName, $metaValue );

        return $this;
    }

    public $metadatas = array();
}
                        </code></pre>
                    </section>
                    <section>
                        <h2 class="no-uppercase">Document : Test</h2>
                        <pre class="stretch"><code data-trim class="php">
namespace tests\units;

class Document extends atoum\test
{
    public function testClass()
    {
        $this
            ->testedClass
                ->hasNoParent()
        ;
    }

    public function testHasMethod()
    {
        $this
            ->testedClass
                ->hasMethod( '__construct' )
                ->hasMethod( '__get' )
                ->hasMethod( 'addMeta' )
        ;
    }
}
                        </code></pre>
                    </section>
                    <section>
                        <h2 class="no-uppercase">Document : Test</h2>
                        <pre class="stretch"><code data-trim class="php">
public function test__construct()
{
    $this
        ->if( $object = new \Document() )
        ->then
            ->array($object->metadatas)->isEmpty()
    ;
}

public function test__get()
{
    $this
        ->if( $object = new \Document() )
        ->and( $property = uniqid() )
        ->then
            ->exception(function() use ($object, $property) { $object->$property; })
                ->isInstanceOf('Exception')
                ->hasMessage("Unable to __get $property properties.")

        ->if( $object->addMeta($name = uniqid(), $value = uniqid()) )
        ->then
            ->string( $object->$name )->isEqualTo($value)
    ;
}
                        </code></pre>
                    </section>
                    <section>
                        <h2 class="no-uppercase">Document : Test</h2>
                        <pre class="stretch"><code data-trim class="php">
public function testAddMeta()
{
    $this
        ->if( $object = new \Document() )
        ->and( $object1 = $object->addMeta($name = uniqid(), $value = uniqid()) )
        ->then
            ->object($object1)->isEqualTo($object)
            ->array($object->metadatas)->hasSize(1)

        ->if( $meta = new \Metadata( $name, $value ) )
        ->then
            ->object($object->metadatas[0])->isEqualTo($meta)

        ->if( $object->addMeta($name, $value = uniqid()) )
        ->then
            ->array($object->metadatas)->hasSize(1)

        ->if( $object->addMeta($name = uniqid(), $value = uniqid()) )
        ->then
            ->array($object->metadatas)->hasSize(2)
    ;
}
                        </code></pre>
                        <p class="fragment">Couverture de code : 100%</p>
                    </section>
                    <section>
                        <h2 class="no-uppercase">Varnish : Classe</h2>
                        <pre><code data-trim class="php">
class Varnish
{
    public function getStatus()
    {
        ...
        $this->execute($request, $hostname, $port);
        ...
        return $status;
    }

    public function execute($request, $host, $port)
    {
        // Code faisant appel à fsockopen, stream_set_timeout, fgets
        return $something;
    }
}
$status = (new Varnish)->getStatus();
                        </code></pre>
                        <p class="fragment"><strong class="red">Danger : </strong> appel réseau</p>
                        <p class="fragment"><strong class="green">Solution : </strong> mock</p>
                    </section>
                    <section>
                        <h2 class="no-uppercase">Varnish : Test</h2>
                        <pre><code data-trim class="php">
public function testStatus()
{
    $this
        ->if($fn = function($request, $host, $port) {
            return $something;
        })
        ->and($varnish = new \mock\Varnish())
        ->and($varnish->getMockController()->execute = $fn)
        ->and($status = $oVarnish->getStatus())
        ->then
            ...
    ;
}
                        </code></pre>
                    </section>
                </section>

                <section>
                    <h2>Questions ?</h2>
                </section>

            </div>

        </div>

        <footer class="slide-footer">
            Réu tech - Clever Age - Jérémy Poulain
        </footer>

        <script src="lib/js/head.min.js"></script>
        <script src="js/reveal.min.js"></script>

        <script>

            // Full list of configuration options available here:
            // https://github.com/hakimel/reveal.js#configuration
            Reveal.initialize({
                controls: true,
                progress: true,
                history: true,
                center: true,
                slideNumber: true,

                theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
                transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/fade/none

                // Parallax scrolling
                // parallaxBackgroundImage: 'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg',
                // parallaxBackgroundSize: '2100px 900px',

                // Optional libraries used to extend on reveal.js
                dependencies: [
                    { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
                    { src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
                    { src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
                    { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
                    { src: 'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
                    { src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
                ]
            });

            Reveal.addEventListener('ready', function() {
                var bg = document.getElementsByClassName('state-background')[0];
                bg.innerHTML =
                        '<div id="test-type">\
                            <div class="chapter1"></div>\
                            <div class="chapter2"></div>\
                            <div class="chapter3"></div>\
                            <div class="chapter4"></div>\
                            <div class="chapter5"></div>\
                        </div>';
            }, false );

        </script>

    </body>
</html>
